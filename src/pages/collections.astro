---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.astro';
import StructuredData from '../components/StructuredData.astro';

// Get all collections
const collectionsData = await getCollection('collections');

// Get all content types to count items in each collection
const letters = await getCollection('letters');
const speeches = await getCollection('speeches');
const lectures = await getCollection('lectures');
const allContent = [...letters, ...speeches, ...lectures];

// Count items in each collection and get content types
const collections = collectionsData.map(collection => {
  const itemsInCollection = allContent.filter(item => 
    item.data.collections?.includes(collection.slug)
  );
  
  const count = itemsInCollection.length;
  
  // Get unique content types in this collection
  const contentTypes = [...new Set(itemsInCollection.map(item => {
    if (letters.includes(item)) return 'letter';
    if (speeches.includes(item)) return 'speech';
    if (lectures.includes(item)) return 'lecture';
    return 'unknown';
  }))].filter(t => t !== 'unknown');
  
  return {
    ...collection,
    count,
    contentTypes
  };
}).sort((a, b) => b.count - a.count);
---

<Layout title="Collections - Paper Lanterns" description="Explore curated thematic collections of letters and speeches organized by emotion, topic, and historical significance.">
  <StructuredData
    type="CollectionPage"
    title="Collections - Paper Lanterns"
    description="Explore curated thematic collections of letters and speeches organized by emotion, topic, and historical significance."
    url={Astro.url.href}
  />
  <Navigation />

  <main class="collections-container">
    <div class="container">
      <header class="collections-header">
        <h1 class="collections-title">Collections</h1>
        <p class="collections-description">
          Discover letters and speeches organized by theme, emotion, and historical significance. 
          Each collection offers a unique lens through which to explore the human experience across time.
        </p>
      </header>

      <div class="content-types-info">
        <p class="content-info">
          Our collections span <strong>letters</strong>, <strong>speeches</strong>, <strong>essays</strong>, and <strong>lectures</strong> 
          from history's most fascinating figures. Each collection is curated around themes that reveal 
          the timeless human experiences that connect us across centuries.
        </p>
      </div>

      <div class="collections-grid">
        {collections.map((collection, index) => {
          // Map collection slugs to visual identities
          const identityMap = {
            'love-letters': { symbol: '◎', class: 'love-letters' },
            'wartime-correspondence': { symbol: '━  ━', class: 'wartime' },
            'scientific-correspondence': { symbol: '· ⋆ ·', class: 'scientific' },
            'creative-struggles': { symbol: '⚡', class: 'creative' },
            'prison-letters': { symbol: '║', class: 'prison' },
            'family-letters': { symbol: '◈', class: 'family' }
          };
          const identity = identityMap[collection.slug] || { symbol: '◇', class: '' };

          return (
            <article class={`collection-card ${identity.class} ${index === 0 ? 'featured' : ''}`}>
              <div class="collection-visual-header">
                <span class="collection-symbol">{identity.symbol}</span>
                <h2 class="collection-name">{collection.data.name}</h2>
                <span class="collection-count">{collection.count} pieces</span>
              </div>
              <div class="card-content">
                <p class="collection-description">
                  {collection.data.description}
                </p>
                <a href={`/collection/${collection.slug}`} class="collection-link">
                  View Collection →
                </a>
              </div>
            </article>
          );
        })}
      </div>

      <section class="browse-types">
        <h2 class="section-title">Browse by Content Type</h2>
        <div class="type-links">
          <a href="/letters" class="type-link">
            <h3>Letters</h3>
            <p>Personal correspondence that reveals intimate thoughts and relationships</p>
          </a>
          <a href="/speeches" class="type-link">
            <h3>Speeches</h3>
            <p>Historic orations that moved nations and shaped history</p>
          </a>
          <a href="/essays" class="type-link">
            <h3>Essays</h3>
            <p>Thoughtful reflections on life, society, and human nature</p>
          </a>
          <a href="/lectures" class="type-link">
            <h3>Lectures</h3>
            <p>Academic and philosophical teachings from great minds</p>
          </a>
        </div>
      </section>

      <footer class="collections-footer">
        <p>All content is in the public domain</p>
      </footer>
    </div>
  </main>
</Layout>

<style>
  .collections-container {
    padding: 10vh 6vw 8vh;
    min-height: 100vh;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0;
  }

  .collections-header {
    text-align: center;
    margin-bottom: 6rem;
  }

  .collections-title {
    font-family: 'Crimson Pro', 'Georgia', serif;
    font-size: clamp(2.5rem, 6vw, 4.5rem);
    font-weight: 300;
    letter-spacing: -0.03em;
    color: var(--text-primary);
    margin-bottom: 1.5rem;
    line-height: 1.1;
  }

  .collections-description {
    font-size: 1.0625rem;
    color: var(--text-tertiary);
    line-height: 1.75;
    max-width: 740px;
    margin: 0 auto;
    font-weight: 300;
    letter-spacing: 0.01em;
  }

  .content-types-info {
    text-align: center;
    margin-bottom: 5rem;
    padding: 3rem;
    background: var(--bg-secondary);
    border-radius: 2px;
    border: 1px solid var(--border-secondary);
  }

  .content-info {
    font-size: 1.0625rem;
    line-height: 1.85;
    color: var(--text-secondary);
    max-width: 840px;
    margin: 0 auto;
    font-weight: 300;
  }

  .content-info strong {
    color: var(--text-primary);
    font-weight: 500;
  }

  .collections-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
    gap: 2.5rem;
    margin-bottom: 8vh;
  }

  .collection-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-secondary);
    position: relative;
    overflow: hidden;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .collection-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px var(--border-primary);
  }

  /* REFINED: Visual header with decorative symbol */
  .collection-visual-header {
    position: relative;
    padding: 3rem 2.5rem 2rem;
    text-align: center;
    border-bottom: 1px solid var(--border-primary);
  }

  .collection-symbol {
    font-size: 3rem;
    margin-bottom: 1.5rem;
    display: block;
    opacity: 0.4;
    line-height: 1;
  }

  .card-content {
    padding: 2.5rem;
  }

  .collection-name {
    font-family: 'Crimson Pro', 'Georgia', serif;
    font-size: 1.5rem;
    font-weight: 400;
    letter-spacing: -0.015em;
    color: var(--text-primary);
    line-height: 1.3;
    margin-bottom: 0.75rem;
  }

  .collection-count {
    font-size: 0.875rem;
    color: var(--text-light);
    font-weight: 400;
    font-family: 'Inter', -apple-system, sans-serif;
  }

  /* REFINED: Theme-specific styling for each collection */
  .love-letters .collection-visual-header {
    background: linear-gradient(135deg, rgba(255, 230, 230, 0.3) 0%, rgba(255, 240, 240, 0.2) 100%);
  }
  .love-letters .collection-symbol {
    color: rgba(220, 120, 130, 0.5);
  }

  .wartime .collection-visual-header {
    background: linear-gradient(135deg, rgba(90, 90, 100, 0.08) 0%, rgba(100, 100, 110, 0.05) 100%);
  }
  .wartime .collection-symbol {
    color: rgba(80, 80, 90, 0.35);
  }

  .scientific .collection-visual-header {
    background: linear-gradient(135deg, rgba(180, 200, 220, 0.15) 0%, rgba(200, 215, 230, 0.1) 100%);
  }
  .scientific .collection-symbol {
    color: rgba(100, 140, 180, 0.4);
  }

  .creative .collection-visual-header {
    background: linear-gradient(135deg, rgba(230, 170, 120, 0.15) 0%, rgba(240, 190, 140, 0.1) 100%);
  }
  .creative .collection-symbol {
    color: rgba(200, 140, 90, 0.45);
  }

  .prison .collection-visual-header {
    background: linear-gradient(135deg, rgba(120, 100, 90, 0.08) 0%, rgba(130, 110, 100, 0.05) 100%);
    border-left: 4px solid rgba(100, 80, 70, 0.3);
    border-right: 4px solid rgba(100, 80, 70, 0.3);
  }
  .prison .collection-symbol {
    color: rgba(100, 80, 70, 0.4);
  }

  .family .collection-visual-header {
    background: linear-gradient(135deg, rgba(200, 180, 150, 0.12) 0%, rgba(210, 190, 160, 0.08) 100%);
  }
  .family .collection-symbol {
    color: rgba(170, 140, 110, 0.4);
  }

  .collection-description {
    color: var(--text-secondary);
    line-height: 1.75;
    margin-bottom: 2rem;
    font-weight: 300;
    font-size: 1rem;
  }

  .collection-link {
    color: var(--text-secondary);
    text-decoration: none;
    font-weight: 400;
    font-size: 0.6875rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    font-family: 'Inter', -apple-system, sans-serif;
    border-bottom: 1px solid rgba(23, 23, 23, 0.15);
    padding-bottom: 0.25rem;
    display: inline-block;
  }

  .browse-types {
    margin-bottom: 6vh;
  }

  .type-links {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-top: 2.5rem;
  }

  .type-link {
    display: block;
    padding: 2.5rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border-secondary);
    border-radius: 2px;
    text-decoration: none;
  }

  .type-link h3 {
    font-family: 'Crimson Pro', 'Georgia', serif;
    font-size: 1.375rem;
    font-weight: 400;
    letter-spacing: -0.015em;
    color: var(--text-primary);
    margin-bottom: 0.75rem;
    line-height: 1.3;
  }

  .type-link p {
    color: var(--text-secondary);
    line-height: 1.75;
    margin: 0;
    font-weight: 300;
    font-size: 1.0625rem;
  }

  .section-title {
    font-family: 'Crimson Pro', 'Georgia', serif;
    font-size: 1.875rem;
    font-weight: 400;
    letter-spacing: -0.02em;
    color: var(--text-primary);
    margin-bottom: 1.5rem;
    line-height: 1.3;
  }

  .section-description {
    color: var(--text-tertiary);
    line-height: 1.75;
    max-width: 640px;
    margin: 0 auto;
    font-weight: 300;
  }

  .collections-footer {
    text-align: center;
    padding-top: 3rem;
    border-top: 1px solid var(--border-secondary);
    color: var(--text-light);
    font-size: 0.8125rem;
    font-weight: 300;
    letter-spacing: 0.02em;
  }

  @media (max-width: 768px) {
    .collections-container {
      padding: 8vh 5vw 6vh;
    }

    .container {
      padding: 0;
    }

    .collections-header {
      margin-bottom: 4rem;
    }

    .collections-title {
      font-size: 2.5rem;
    }

    .collections-description {
      font-size: 1rem;
    }

    .content-types-info {
      padding: 2rem;
      margin-bottom: 4rem;
    }

    .content-info {
      font-size: 1rem;
    }

    .collections-grid {
      grid-template-columns: 1fr;
      gap: 2rem;
      margin-bottom: 6vh;
    }

    .collection-card {
      padding: 2rem;
    }

    .card-header {
      margin-bottom: 1.25rem;
    }

    .collection-name {
      font-size: 1.375rem;
    }

    .collection-description {
      font-size: 1rem;
      margin-bottom: 1.5rem;
    }

    .type-links {
      grid-template-columns: 1fr;
      gap: 1.5rem;
      margin-top: 2rem;
    }

    .type-link {
      padding: 2rem;
    }

    .type-link h3 {
      font-size: 1.25rem;
    }

    .type-link p {
      font-size: 1rem;
    }

    .section-title {
      font-size: 1.5rem;
    }
  }

  @media (max-width: 480px) {
    .collections-container {
      padding: 7vh 5vw 5vh;
    }

    .collections-title {
      font-size: 2rem;
    }

    .collections-description {
      font-size: 0.9375rem;
    }
  }
</style>

